function accordeonFood(){
  const foods = document.querySelectorAll(".food__item");
  const menu = document.querySelector(".accordeon--vertical");
  menu.addEventListener("click" , function(event){
    event.preventDefault();
    const target = event.target;
      if(target.classList.contains("food__vertical")){
        const food = target.parentNode;
        const content = target.nextElementSibling;
          for (const iterator of foods) {
            if(iterator !== food){
              iterator.classList.remove("food__description--active");
              iterator.lastElementChild.style.width= 0;
            }
          }
            if(food.classList.contains("food__description--active")){
              food.classList.remove("food__description--active");
              content.style.width = 0;
            } else {
              food.classList.add("food__description--active");
              content.style.width = calculateWidth() + "px";
          }
      }else if (target.classList.contains("food__name")){
        const food = target.parentNode.parentNode;
        const content = target.parentNode.nextElementSibling;
          for (const iterator of foods) {
            if(iterator !== food){
              iterator.classList.remove("food__description--active");
              iterator.lastElementChild.style.width= 0;
            }
          }
            if(food.classList.contains("food__description--active")){
              food.classList.remove("food__description--active");
              content.style.width = 0;
            } else {
              food.classList.add("food__description--active");
              content.style.width = calculateWidth() + "px";
          }
      }
  });
  function calculateWidth(){
    let windowWidth = document.documentElement.clientWidth;
    let links = document.querySelectorAll('.food__vertical');
    let linksWidth = parseInt(getComputedStyle(links[0]).width);
    let reqWidth = windowWidth - linksWidth * links.length;
    return reqWidth > 520 ? 520 : reqWidth;
  }
  }
  accordeonFood();;function accordeonTeam(){
  const members = document.querySelectorAll(".team__item");
  const team = document.querySelector(".team__list");

  team.addEventListener("click" , function(event){
      event.preventDefault(); 
      const target = event.target; 

      if(target.classList.contains("team__link")){
          const member = target.parentNode; 
          const content = target.nextElementSibling;  
          const contentHeight = content.firstElementChild.clientHeight;
       
              for (const iterator of members) {
                  if(iterator !== member){
                      iterator.classList.remove("team__item--active");
                      iterator.lastElementChild.style.height= 0;
                  }
              }

              if(member.classList.contains("team__item--active")){
                  member.classList.remove("team__item--active");
                  content.style.height = 0;
              }else{
                  member.classList.add("team__item--active");
                  content.style.height = contentHeight + "px";
              }
      }
  });
}

accordeonTeam();
;const myForm = document.querySelector('#delievery');
const orderButton = document.querySelector('#orderButton');

orderButton.addEventListener('click', event => {
  event.preventDefault();

  if (validateForm(myForm)) {
    const data = {
      name: myForm.elements.name.value,
      phone: myForm.elements.phone.value,
      comment: myForm.elements.delievery.value,
      to: 'test@mail.ru',
    };
    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    xhr.open('POST', 'https://webdev-api.loftschool.com/sendmail');
    xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
    xhr.send(JSON.stringify(data));
    xhr.addEventListener('load', () => {
      if (xhr.response.statusText <= 200) {
        let title = 'Ответ от сервера';
        let text = 'Данные получены';
        renderPopup(title, text);
      } else {
        let title = 'Ответ от сервера';
        let text = 'Ошибка сервера';
        renderPopup(title, text);
      }
    })
  }
});

function validateForm(form) {
  let valid = true;

  if (!validateField(form.elements.name)) {
    valid = false;
  }
  if (!validateField(form.elements.phone)) {
    valid = false;
  }
  if (!validateField(form.elements.delievery)) {
    valid = false;
  }

  return valid;
}

function validateField(field) {
  field.nextElementSibling.textContent = field.validationMessage;
  return field.checkValidity();
}
;let burger  = document.querySelector('.hamburger-menu');
let overlay = document.querySelector('.menu');
let body = document.querySelector('body');

let links = document.querySelectorAll('.menu__link');

links.forEach(function(element){
  element.addEventListener('click' , toggleMenu);
})

function toggleMenu(){
  burger.classList.toggle('hamburger-menu--active');
  overlay.classList.toggle('menu--active');
  body.classList.toggle('body--active');
}

burger.addEventListener('click' , toggleMenu);
;let onePageScroll = () => {
  const sections = $(".page");
  const display = $(".main-content");
  let inscroll = false;

  const mobileDetect = new MobileDetect(window.navigator.userAgent);
  const isMobile = mobileDetect.mobile();

  const countPositionPercent = sectionEq => {
    return `${sectionEq * -100}%`;
  };

  const switchActiveClass = (elems, elemNdx) => {
    elems
      .eq(elemNdx)
      .addClass("active")
      .siblings()
      .removeClass("active");
  };

  const unBlockScroll = () => {
    setTimeout(() => {
      inscroll = false;
    }, 1300); // подождать пока завершится инерция на тачпадах
  };

  const performTransition = sectionEq => {
    if (inscroll) return;
    inscroll = true;

    const position = countPositionPercent(sectionEq);
    const switchFixedMenuClass = () =>
      switchActiveClass($(".pagination__item"), sectionEq);

    switchActiveClass(sections, sectionEq);
    switchFixedMenuClass();

    display.css({
      transform: `translateY(${position})`
    });

    unBlockScroll();
  };

  const scrollViewport = direction => {
    const activeSection = sections.filter(".active");
    const nextSection = activeSection.next();
    const prevSection = activeSection.prev();

    if (direction === "next" && nextSection.length) {
      performTransition(nextSection.index());
    }

    if (direction === "prev" && prevSection.length) {
      performTransition(prevSection.index());
    }
  };

  $(document).on({
    wheel: e => {
      const deltaY = e.originalEvent.deltaY;
      const direction = deltaY > 0 ? "next" : "prev";
      scrollViewport(direction);
    },
    keydown: e => {
      const tagName = e.target.tagName.toLowerCase();
      const userTypingInInputs = tagName === "input" || tagName === "textarea";

      if (userTypingInInputs) return;

      switch (e.keyCode) {
        case 40:
          scrollViewport("next");
          break;

        case 38:
          scrollViewport("prev");
          break;
      }
    }
  });

  $("[data-scroll-to]").on("click", e => {
    e.preventDefault();
    performTransition(parseInt($(e.currentTarget).attr("data-scroll-to")));
  });

  // разрешаем свайп на мобильниках
  if (isMobile) {
    window.addEventListener(
      "touchmove",
      e => {
        e.preventDefault();
      },
      { passive: false }
    );

    $("body").swipe({
      swipe: (event, direction) => {
        let scrollDirecrion;
        if (direction === "up") scrollDirecrion = "next";
        if (direction === "down") scrollDirecrion = "prev";
        scrollViewport(scrollDirecrion);
      }
    });
  }
}

onePageScroll();;let player;

const formatTime = timeSec => {
  const roundTime = Math.round(timeSec);

  const minutes = Math.floor(roundTime / 60);
  const seconds = roundTime - minutes * 60;

  const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;

  return `${minutes}:${formattedSeconds}`;
};

const onPlayerReady = () => {
  let interval;
  let durationSec = player.getDuration();

  $(".player__duration-estimate").text(formatTime(durationSec));

  if (typeof interval !== "undefined") {
    clearInterval(interval);
  }

  interval = setInterval(() => {
    const completedSec = player.getCurrentTime();
    const completedPercent = (completedSec / durationSec) * 100;

    $(".player__playback-button").css({
      left: `${completedPercent}%`
    });

    $(".player__duration-completed").text(formatTime(completedSec));
  }, 1000);
};

const eventsInit = () => {
  $(".player__start").on("click", e => {
    e.preventDefault();
    const btn = $(e.currentTarget);

    if (btn.hasClass("paused")) {
      player.pauseVideo();
    } else {
      player.playVideo();
    }
  });

  $(".player__playback").on("click", e => {
    const bar = $(e.currentTarget);
    const newButtonPosition = e.pageX - bar.offset().left;
    const buttonPosPercent = (newButtonPosition / bar.width()) * 100;
    const newPlayerTimeSec = (player.getDuration() / 100) * buttonPosPercent;

    $(".player__playback-button").css({
      left: `${buttonPosPercent}%`
    });

    player.seekTo(newPlayerTimeSec);
  });

  $(".player__splash").on("click", e => {
    player.playVideo();
  });
};

const onPlayerStateChange = event => {
  const playerButton = $(".player__start");
  /*
  -1 (воспроизведение видео не начато)
  0 (воспроизведение видео завершено)
  1 (воспроизведение)
  2 (пауза)
  3 (буферизация)
  5 (видео подают реплики).
   */
  switch (event.data) {
    case 1: 
      $('.player__wrapper').addClass('active');
      playerButton.addClass("paused");
      break;
    case 2: 
      playerButton.removeClass("paused");
      break;
  }
};

function onYouTubeIframeAPIReady() {
  player = new YT.Player("yt-player", {
    height: "405",
    width: "660",
    videoId: "KEkrWRHCDQU",
    events: {
      onReady: onPlayerReady,
      onStateChange: onPlayerStateChange
    },
    playerVars: {
      controls: 0,
      disablekb: 0,
      showinfo: 0,
      rel: 0,
      autoplay: 0,
      modestbranding: 0
    }
  });
}

eventsInit();;let popupFeedback = () => {
    function popupReview(){
    const reviewList = document.querySelector('.feedback__list');
  
    reviewList.addEventListener('click' , function(e){
      if(e.target.classList.contains('feedback__btn')){
        const title = e.target.parentNode.querySelector('.feedback__subtitle').textContent;
        const text = e.target.parentNode.querySelector('.feedback__text').textContent;
      
        renderPopup(title, text);
      }
    })
  }

  popupReview();
  }
popupFeedback();;function renderPopup(title, text){
  const popup = document.querySelector('.popup');

  popup.classList.add('popup--active');

  popup.querySelector('.popup__title').textContent = title;
  popup.querySelector('.popup__text').textContent = text;

  popup.querySelector('.popup__exit').addEventListener('click' , e=>{
    e.preventDefault();

    popup.classList.remove('popup--active');
  })
};let sliderBurger = () => {
  const left = document.querySelector(".arrow__slide--left");
  const right = document.querySelector(".arrow__slide--right");
  const items = document.querySelector("#slider");

  right.addEventListener("click", function(e) {
    e.preventDefault();
    loop("right");
  });

  left.addEventListener("click", function(e) {
    e.preventDefault();
    loop("left");
  });

  function loop(direction) {
    if (direction === "right") {
      items.appendChild(items.firstElementChild);
    } else {
      items.insertBefore(items.lastElementChild, items.firstElementChild);
    }
  }
}
sliderBurger();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGVvbi1mb29kLmpzIiwiYWNjb3JkZW9uLXRlYW0uanMiLCJmb3JtLmpzIiwiZnVsbG1lbnUuanMiLCJvcHMuanMiLCJwbGF5ZXIuanMiLCJwb3B1cC5qcyIsInJlbmRlclBvcHVwLmpzIiwic2xpZGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJDNUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0MxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYWNjb3JkZW9uRm9vZCgpe1xyXG4gIGNvbnN0IGZvb2RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mb29kX19pdGVtXCIpO1xyXG4gIGNvbnN0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmFjY29yZGVvbi0tdmVydGljYWxcIik7XHJcbiAgbWVudS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiAsIGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XHJcbiAgICAgIGlmKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJmb29kX192ZXJ0aWNhbFwiKSl7XHJcbiAgICAgICAgY29uc3QgZm9vZCA9IHRhcmdldC5wYXJlbnROb2RlO1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0YXJnZXQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgZm9yIChjb25zdCBpdGVyYXRvciBvZiBmb29kcykge1xyXG4gICAgICAgICAgICBpZihpdGVyYXRvciAhPT0gZm9vZCl7XHJcbiAgICAgICAgICAgICAgaXRlcmF0b3IuY2xhc3NMaXN0LnJlbW92ZShcImZvb2RfX2Rlc2NyaXB0aW9uLS1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgaXRlcmF0b3IubGFzdEVsZW1lbnRDaGlsZC5zdHlsZS53aWR0aD0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihmb29kLmNsYXNzTGlzdC5jb250YWlucyhcImZvb2RfX2Rlc2NyaXB0aW9uLS1hY3RpdmVcIikpe1xyXG4gICAgICAgICAgICAgIGZvb2QuY2xhc3NMaXN0LnJlbW92ZShcImZvb2RfX2Rlc2NyaXB0aW9uLS1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgY29udGVudC5zdHlsZS53aWR0aCA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZm9vZC5jbGFzc0xpc3QuYWRkKFwiZm9vZF9fZGVzY3JpcHRpb24tLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLndpZHRoID0gY2FsY3VsYXRlV2lkdGgoKSArIFwicHhcIjtcclxuICAgICAgICAgIH1cclxuICAgICAgfWVsc2UgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJmb29kX19uYW1lXCIpKXtcclxuICAgICAgICBjb25zdCBmb29kID0gdGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZTtcclxuICAgICAgICBjb25zdCBjb250ZW50ID0gdGFyZ2V0LnBhcmVudE5vZGUubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgZm9yIChjb25zdCBpdGVyYXRvciBvZiBmb29kcykge1xyXG4gICAgICAgICAgICBpZihpdGVyYXRvciAhPT0gZm9vZCl7XHJcbiAgICAgICAgICAgICAgaXRlcmF0b3IuY2xhc3NMaXN0LnJlbW92ZShcImZvb2RfX2Rlc2NyaXB0aW9uLS1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgaXRlcmF0b3IubGFzdEVsZW1lbnRDaGlsZC5zdHlsZS53aWR0aD0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihmb29kLmNsYXNzTGlzdC5jb250YWlucyhcImZvb2RfX2Rlc2NyaXB0aW9uLS1hY3RpdmVcIikpe1xyXG4gICAgICAgICAgICAgIGZvb2QuY2xhc3NMaXN0LnJlbW92ZShcImZvb2RfX2Rlc2NyaXB0aW9uLS1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgY29udGVudC5zdHlsZS53aWR0aCA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZm9vZC5jbGFzc0xpc3QuYWRkKFwiZm9vZF9fZGVzY3JpcHRpb24tLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLndpZHRoID0gY2FsY3VsYXRlV2lkdGgoKSArIFwicHhcIjtcclxuICAgICAgICAgIH1cclxuICAgICAgfVxyXG4gIH0pO1xyXG4gIGZ1bmN0aW9uIGNhbGN1bGF0ZVdpZHRoKCl7XHJcbiAgICBsZXQgd2luZG93V2lkdGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XHJcbiAgICBsZXQgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZm9vZF9fdmVydGljYWwnKTtcclxuICAgIGxldCBsaW5rc1dpZHRoID0gcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShsaW5rc1swXSkud2lkdGgpO1xyXG4gICAgbGV0IHJlcVdpZHRoID0gd2luZG93V2lkdGggLSBsaW5rc1dpZHRoICogbGlua3MubGVuZ3RoO1xyXG4gICAgcmV0dXJuIHJlcVdpZHRoID4gNTIwID8gNTIwIDogcmVxV2lkdGg7XHJcbiAgfVxyXG4gIH1cclxuICBhY2NvcmRlb25Gb29kKCk7IiwiZnVuY3Rpb24gYWNjb3JkZW9uVGVhbSgpe1xyXG4gIGNvbnN0IG1lbWJlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRlYW1fX2l0ZW1cIik7XHJcbiAgY29uc3QgdGVhbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVhbV9fbGlzdFwiKTtcclxuXHJcbiAgdGVhbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiAsIGZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDsgXHJcblxyXG4gICAgICBpZih0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGVhbV9fbGlua1wiKSl7XHJcbiAgICAgICAgICBjb25zdCBtZW1iZXIgPSB0YXJnZXQucGFyZW50Tm9kZTsgXHJcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGFyZ2V0Lm5leHRFbGVtZW50U2libGluZzsgIFxyXG4gICAgICAgICAgY29uc3QgY29udGVudEhlaWdodCA9IGNvbnRlbnQuZmlyc3RFbGVtZW50Q2hpbGQuY2xpZW50SGVpZ2h0O1xyXG4gICAgICAgXHJcbiAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVyYXRvciBvZiBtZW1iZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmKGl0ZXJhdG9yICE9PSBtZW1iZXIpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IuY2xhc3NMaXN0LnJlbW92ZShcInRlYW1fX2l0ZW0tLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9yLmxhc3RFbGVtZW50Q2hpbGQuc3R5bGUuaGVpZ2h0PSAwO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBpZihtZW1iZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGVhbV9faXRlbS0tYWN0aXZlXCIpKXtcclxuICAgICAgICAgICAgICAgICAgbWVtYmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJ0ZWFtX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUuaGVpZ2h0ID0gMDtcclxuICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgbWVtYmVyLmNsYXNzTGlzdC5hZGQoXCJ0ZWFtX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUuaGVpZ2h0ID0gY29udGVudEhlaWdodCArIFwicHhcIjtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuYWNjb3JkZW9uVGVhbSgpO1xyXG4iLCJjb25zdCBteUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGVsaWV2ZXJ5Jyk7XHJcbmNvbnN0IG9yZGVyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI29yZGVyQnV0dG9uJyk7XHJcblxyXG5vcmRlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBpZiAodmFsaWRhdGVGb3JtKG15Rm9ybSkpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIG5hbWU6IG15Rm9ybS5lbGVtZW50cy5uYW1lLnZhbHVlLFxyXG4gICAgICBwaG9uZTogbXlGb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlLFxyXG4gICAgICBjb21tZW50OiBteUZvcm0uZWxlbWVudHMuZGVsaWV2ZXJ5LnZhbHVlLFxyXG4gICAgICB0bzogJ3Rlc3RAbWFpbC5ydScsXHJcbiAgICB9O1xyXG4gICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2pzb24nO1xyXG4gICAgeGhyLm9wZW4oJ1BPU1QnLCAnaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsJyk7XHJcbiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcclxuICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xyXG4gICAgICBpZiAoeGhyLnJlc3BvbnNlLnN0YXR1c1RleHQgPD0gMjAwKSB7XHJcbiAgICAgICAgbGV0IHRpdGxlID0gJ9Ce0YLQstC10YIg0L7RgiDRgdC10YDQstC10YDQsCc7XHJcbiAgICAgICAgbGV0IHRleHQgPSAn0JTQsNC90L3Ri9C1INC/0L7Qu9GD0YfQtdC90YsnO1xyXG4gICAgICAgIHJlbmRlclBvcHVwKHRpdGxlLCB0ZXh0KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgdGl0bGUgPSAn0J7RgtCy0LXRgiDQvtGCINGB0LXRgNCy0LXRgNCwJztcclxuICAgICAgICBsZXQgdGV4dCA9ICfQntGI0LjQsdC60LAg0YHQtdGA0LLQtdGA0LAnO1xyXG4gICAgICAgIHJlbmRlclBvcHVwKHRpdGxlLCB0ZXh0KTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gdmFsaWRhdGVGb3JtKGZvcm0pIHtcclxuICBsZXQgdmFsaWQgPSB0cnVlO1xyXG5cclxuICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5uYW1lKSkge1xyXG4gICAgdmFsaWQgPSBmYWxzZTtcclxuICB9XHJcbiAgaWYgKCF2YWxpZGF0ZUZpZWxkKGZvcm0uZWxlbWVudHMucGhvbmUpKSB7XHJcbiAgICB2YWxpZCA9IGZhbHNlO1xyXG4gIH1cclxuICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5kZWxpZXZlcnkpKSB7XHJcbiAgICB2YWxpZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHZhbGlkO1xyXG59XHJcblxyXG5mdW5jdGlvbiB2YWxpZGF0ZUZpZWxkKGZpZWxkKSB7XHJcbiAgZmllbGQubmV4dEVsZW1lbnRTaWJsaW5nLnRleHRDb250ZW50ID0gZmllbGQudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgcmV0dXJuIGZpZWxkLmNoZWNrVmFsaWRpdHkoKTtcclxufVxyXG4iLCJsZXQgYnVyZ2VyICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oYW1idXJnZXItbWVudScpO1xyXG5sZXQgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tZW51Jyk7XHJcbmxldCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xyXG5cclxubGV0IGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnVfX2xpbmsnKTtcclxuXHJcbmxpbmtzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCl7XHJcbiAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycgLCB0b2dnbGVNZW51KTtcclxufSlcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZU1lbnUoKXtcclxuICBidXJnZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyLW1lbnUtLWFjdGl2ZScpO1xyXG4gIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnbWVudS0tYWN0aXZlJyk7XHJcbiAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdib2R5LS1hY3RpdmUnKTtcclxufVxyXG5cclxuYnVyZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyAsIHRvZ2dsZU1lbnUpO1xyXG4iLCJsZXQgb25lUGFnZVNjcm9sbCA9ICgpID0+IHtcclxuICBjb25zdCBzZWN0aW9ucyA9ICQoXCIucGFnZVwiKTtcclxuICBjb25zdCBkaXNwbGF5ID0gJChcIi5tYWluLWNvbnRlbnRcIik7XHJcbiAgbGV0IGluc2Nyb2xsID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG4gIGNvbnN0IGlzTW9iaWxlID0gbW9iaWxlRGV0ZWN0Lm1vYmlsZSgpO1xyXG5cclxuICBjb25zdCBjb3VudFBvc2l0aW9uUGVyY2VudCA9IHNlY3Rpb25FcSA9PiB7XHJcbiAgICByZXR1cm4gYCR7c2VjdGlvbkVxICogLTEwMH0lYDtcclxuICB9O1xyXG5cclxuICBjb25zdCBzd2l0Y2hBY3RpdmVDbGFzcyA9IChlbGVtcywgZWxlbU5keCkgPT4ge1xyXG4gICAgZWxlbXNcclxuICAgICAgLmVxKGVsZW1OZHgpXHJcbiAgICAgIC5hZGRDbGFzcyhcImFjdGl2ZVwiKVxyXG4gICAgICAuc2libGluZ3MoKVxyXG4gICAgICAucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgdW5CbG9ja1Njcm9sbCA9ICgpID0+IHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpbnNjcm9sbCA9IGZhbHNlO1xyXG4gICAgfSwgMTMwMCk7IC8vINC/0L7QtNC+0LbQtNCw0YLRjCDQv9C+0LrQsCDQt9Cw0LLQtdGA0YjQuNGC0YHRjyDQuNC90LXRgNGG0LjRjyDQvdCwINGC0LDRh9C/0LDQtNCw0YVcclxuICB9O1xyXG5cclxuICBjb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IHNlY3Rpb25FcSA9PiB7XHJcbiAgICBpZiAoaW5zY3JvbGwpIHJldHVybjtcclxuICAgIGluc2Nyb2xsID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IGNvdW50UG9zaXRpb25QZXJjZW50KHNlY3Rpb25FcSk7XHJcbiAgICBjb25zdCBzd2l0Y2hGaXhlZE1lbnVDbGFzcyA9ICgpID0+XHJcbiAgICAgIHN3aXRjaEFjdGl2ZUNsYXNzKCQoXCIucGFnaW5hdGlvbl9faXRlbVwiKSwgc2VjdGlvbkVxKTtcclxuXHJcbiAgICBzd2l0Y2hBY3RpdmVDbGFzcyhzZWN0aW9ucywgc2VjdGlvbkVxKTtcclxuICAgIHN3aXRjaEZpeGVkTWVudUNsYXNzKCk7XHJcblxyXG4gICAgZGlzcGxheS5jc3Moe1xyXG4gICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259KWBcclxuICAgIH0pO1xyXG5cclxuICAgIHVuQmxvY2tTY3JvbGwoKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBzY3JvbGxWaWV3cG9ydCA9IGRpcmVjdGlvbiA9PiB7XHJcbiAgICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZVwiKTtcclxuICAgIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbiAgICBjb25zdCBwcmV2U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ucHJldigpO1xyXG5cclxuICAgIGlmIChkaXJlY3Rpb24gPT09IFwibmV4dFwiICYmIG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICBwZXJmb3JtVHJhbnNpdGlvbihuZXh0U2VjdGlvbi5pbmRleCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGlyZWN0aW9uID09PSBcInByZXZcIiAmJiBwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgcGVyZm9ybVRyYW5zaXRpb24ocHJldlNlY3Rpb24uaW5kZXgoKSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJChkb2N1bWVudCkub24oe1xyXG4gICAgd2hlZWw6IGUgPT4ge1xyXG4gICAgICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG4gICAgICBjb25zdCBkaXJlY3Rpb24gPSBkZWx0YVkgPiAwID8gXCJuZXh0XCIgOiBcInByZXZcIjtcclxuICAgICAgc2Nyb2xsVmlld3BvcnQoZGlyZWN0aW9uKTtcclxuICAgIH0sXHJcbiAgICBrZXlkb3duOiBlID0+IHtcclxuICAgICAgY29uc3QgdGFnTmFtZSA9IGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgY29uc3QgdXNlclR5cGluZ0luSW5wdXRzID0gdGFnTmFtZSA9PT0gXCJpbnB1dFwiIHx8IHRhZ05hbWUgPT09IFwidGV4dGFyZWFcIjtcclxuXHJcbiAgICAgIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuXHJcbiAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgIHNjcm9sbFZpZXdwb3J0KFwibmV4dFwiKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIDM4OlxyXG4gICAgICAgICAgc2Nyb2xsVmlld3BvcnQoXCJwcmV2XCIpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgJChcIltkYXRhLXNjcm9sbC10b11cIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIHBlcmZvcm1UcmFuc2l0aW9uKHBhcnNlSW50KCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIikpKTtcclxuICB9KTtcclxuXHJcbiAgLy8g0YDQsNC30YDQtdGI0LDQtdC8INGB0LLQsNC50L8g0L3QsCDQvNC+0LHQuNC70YzQvdC40LrQsNGFXHJcbiAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgXCJ0b3VjaG1vdmVcIixcclxuICAgICAgZSA9PiB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB9LFxyXG4gICAgICB7IHBhc3NpdmU6IGZhbHNlIH1cclxuICAgICk7XHJcblxyXG4gICAgJChcImJvZHlcIikuc3dpcGUoe1xyXG4gICAgICBzd2lwZTogKGV2ZW50LCBkaXJlY3Rpb24pID0+IHtcclxuICAgICAgICBsZXQgc2Nyb2xsRGlyZWNyaW9uO1xyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwidXBcIikgc2Nyb2xsRGlyZWNyaW9uID0gXCJuZXh0XCI7XHJcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJkb3duXCIpIHNjcm9sbERpcmVjcmlvbiA9IFwicHJldlwiO1xyXG4gICAgICAgIHNjcm9sbFZpZXdwb3J0KHNjcm9sbERpcmVjcmlvbik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxub25lUGFnZVNjcm9sbCgpOyIsImxldCBwbGF5ZXI7XHJcblxyXG5jb25zdCBmb3JtYXRUaW1lID0gdGltZVNlYyA9PiB7XHJcbiAgY29uc3Qgcm91bmRUaW1lID0gTWF0aC5yb3VuZCh0aW1lU2VjKTtcclxuXHJcbiAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3Iocm91bmRUaW1lIC8gNjApO1xyXG4gIGNvbnN0IHNlY29uZHMgPSByb3VuZFRpbWUgLSBtaW51dGVzICogNjA7XHJcblxyXG4gIGNvbnN0IGZvcm1hdHRlZFNlY29uZHMgPSBzZWNvbmRzIDwgMTAgPyBgMCR7c2Vjb25kc31gIDogc2Vjb25kcztcclxuXHJcbiAgcmV0dXJuIGAke21pbnV0ZXN9OiR7Zm9ybWF0dGVkU2Vjb25kc31gO1xyXG59O1xyXG5cclxuY29uc3Qgb25QbGF5ZXJSZWFkeSA9ICgpID0+IHtcclxuICBsZXQgaW50ZXJ2YWw7XHJcbiAgbGV0IGR1cmF0aW9uU2VjID0gcGxheWVyLmdldER1cmF0aW9uKCk7XHJcblxyXG4gICQoXCIucGxheWVyX19kdXJhdGlvbi1lc3RpbWF0ZVwiKS50ZXh0KGZvcm1hdFRpbWUoZHVyYXRpb25TZWMpKTtcclxuXHJcbiAgaWYgKHR5cGVvZiBpbnRlcnZhbCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbiAgfVxyXG5cclxuICBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgIGNvbnN0IGNvbXBsZXRlZFNlYyA9IHBsYXllci5nZXRDdXJyZW50VGltZSgpO1xyXG4gICAgY29uc3QgY29tcGxldGVkUGVyY2VudCA9IChjb21wbGV0ZWRTZWMgLyBkdXJhdGlvblNlYykgKiAxMDA7XHJcblxyXG4gICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvblwiKS5jc3Moe1xyXG4gICAgICBsZWZ0OiBgJHtjb21wbGV0ZWRQZXJjZW50fSVgXHJcbiAgICB9KTtcclxuXHJcbiAgICAkKFwiLnBsYXllcl9fZHVyYXRpb24tY29tcGxldGVkXCIpLnRleHQoZm9ybWF0VGltZShjb21wbGV0ZWRTZWMpKTtcclxuICB9LCAxMDAwKTtcclxufTtcclxuXHJcbmNvbnN0IGV2ZW50c0luaXQgPSAoKSA9PiB7XHJcbiAgJChcIi5wbGF5ZXJfX3N0YXJ0XCIpLm9uKFwiY2xpY2tcIiwgZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCBidG4gPSAkKGUuY3VycmVudFRhcmdldCk7XHJcblxyXG4gICAgaWYgKGJ0bi5oYXNDbGFzcyhcInBhdXNlZFwiKSkge1xyXG4gICAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAkKFwiLnBsYXllcl9fcGxheWJhY2tcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgIGNvbnN0IGJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IG5ld0J1dHRvblBvc2l0aW9uID0gZS5wYWdlWCAtIGJhci5vZmZzZXQoKS5sZWZ0O1xyXG4gICAgY29uc3QgYnV0dG9uUG9zUGVyY2VudCA9IChuZXdCdXR0b25Qb3NpdGlvbiAvIGJhci53aWR0aCgpKSAqIDEwMDtcclxuICAgIGNvbnN0IG5ld1BsYXllclRpbWVTZWMgPSAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogYnV0dG9uUG9zUGVyY2VudDtcclxuXHJcbiAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XHJcbiAgICAgIGxlZnQ6IGAke2J1dHRvblBvc1BlcmNlbnR9JWBcclxuICAgIH0pO1xyXG5cclxuICAgIHBsYXllci5zZWVrVG8obmV3UGxheWVyVGltZVNlYyk7XHJcbiAgfSk7XHJcblxyXG4gICQoXCIucGxheWVyX19zcGxhc2hcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgIHBsYXllci5wbGF5VmlkZW8oKTtcclxuICB9KTtcclxufTtcclxuXHJcbmNvbnN0IG9uUGxheWVyU3RhdGVDaGFuZ2UgPSBldmVudCA9PiB7XHJcbiAgY29uc3QgcGxheWVyQnV0dG9uID0gJChcIi5wbGF5ZXJfX3N0YXJ0XCIpO1xyXG4gIC8qXHJcbiAgLTEgKNCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+INC90LUg0L3QsNGH0LDRgtC+KVxyXG4gIDAgKNCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+INC30LDQstC10YDRiNC10L3QvilcclxuICAxICjQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUpXHJcbiAgMiAo0L/QsNGD0LfQsClcclxuICAzICjQsdGD0YTQtdGA0LjQt9Cw0YbQuNGPKVxyXG4gIDUgKNCy0LjQtNC10L4g0L/QvtC00LDRjtGCINGA0LXQv9C70LjQutC4KS5cclxuICAgKi9cclxuICBzd2l0Y2ggKGV2ZW50LmRhdGEpIHtcclxuICAgIGNhc2UgMTogXHJcbiAgICAgICQoJy5wbGF5ZXJfX3dyYXBwZXInKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgIHBsYXllckJ1dHRvbi5hZGRDbGFzcyhcInBhdXNlZFwiKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlIDI6IFxyXG4gICAgICBwbGF5ZXJCdXR0b24ucmVtb3ZlQ2xhc3MoXCJwYXVzZWRcIik7XHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxufTtcclxuXHJcbmZ1bmN0aW9uIG9uWW91VHViZUlmcmFtZUFQSVJlYWR5KCkge1xyXG4gIHBsYXllciA9IG5ldyBZVC5QbGF5ZXIoXCJ5dC1wbGF5ZXJcIiwge1xyXG4gICAgaGVpZ2h0OiBcIjQwNVwiLFxyXG4gICAgd2lkdGg6IFwiNjYwXCIsXHJcbiAgICB2aWRlb0lkOiBcIktFa3JXUkhDRFFVXCIsXHJcbiAgICBldmVudHM6IHtcclxuICAgICAgb25SZWFkeTogb25QbGF5ZXJSZWFkeSxcclxuICAgICAgb25TdGF0ZUNoYW5nZTogb25QbGF5ZXJTdGF0ZUNoYW5nZVxyXG4gICAgfSxcclxuICAgIHBsYXllclZhcnM6IHtcclxuICAgICAgY29udHJvbHM6IDAsXHJcbiAgICAgIGRpc2FibGVrYjogMCxcclxuICAgICAgc2hvd2luZm86IDAsXHJcbiAgICAgIHJlbDogMCxcclxuICAgICAgYXV0b3BsYXk6IDAsXHJcbiAgICAgIG1vZGVzdGJyYW5kaW5nOiAwXHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV2ZW50c0luaXQoKTsiLCJsZXQgcG9wdXBGZWVkYmFjayA9ICgpID0+IHtcclxuICAgIGZ1bmN0aW9uIHBvcHVwUmV2aWV3KCl7XHJcbiAgICBjb25zdCByZXZpZXdMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZlZWRiYWNrX19saXN0Jyk7XHJcbiAgXHJcbiAgICByZXZpZXdMaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyAsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICBpZihlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2ZlZWRiYWNrX19idG4nKSl7XHJcbiAgICAgICAgY29uc3QgdGl0bGUgPSBlLnRhcmdldC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5mZWVkYmFja19fc3VidGl0bGUnKS50ZXh0Q29udGVudDtcclxuICAgICAgICBjb25zdCB0ZXh0ID0gZS50YXJnZXQucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuZmVlZGJhY2tfX3RleHQnKS50ZXh0Q29udGVudDtcclxuICAgICAgXHJcbiAgICAgICAgcmVuZGVyUG9wdXAodGl0bGUsIHRleHQpO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcG9wdXBSZXZpZXcoKTtcclxuICB9XHJcbnBvcHVwRmVlZGJhY2soKTsiLCJmdW5jdGlvbiByZW5kZXJQb3B1cCh0aXRsZSwgdGV4dCl7XHJcbiAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAnKTtcclxuXHJcbiAgcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXAtLWFjdGl2ZScpO1xyXG5cclxuICBwb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX3RpdGxlJykudGV4dENvbnRlbnQgPSB0aXRsZTtcclxuICBwb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX3RleHQnKS50ZXh0Q29udGVudCA9IHRleHQ7XHJcblxyXG4gIHBvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZXhpdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyAsIGU9PntcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdwb3B1cC0tYWN0aXZlJyk7XHJcbiAgfSlcclxufSIsImxldCBzbGlkZXJCdXJnZXIgPSAoKSA9PiB7XHJcbiAgY29uc3QgbGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYXJyb3dfX3NsaWRlLS1sZWZ0XCIpO1xyXG4gIGNvbnN0IHJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hcnJvd19fc2xpZGUtLXJpZ2h0XCIpO1xyXG4gIGNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzbGlkZXJcIik7XHJcblxyXG4gIHJpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBsb29wKFwicmlnaHRcIik7XHJcbiAgfSk7XHJcblxyXG4gIGxlZnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGxvb3AoXCJsZWZ0XCIpO1xyXG4gIH0pO1xyXG5cclxuICBmdW5jdGlvbiBsb29wKGRpcmVjdGlvbikge1xyXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJyaWdodFwiKSB7XHJcbiAgICAgIGl0ZW1zLmFwcGVuZENoaWxkKGl0ZW1zLmZpcnN0RWxlbWVudENoaWxkKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGl0ZW1zLmluc2VydEJlZm9yZShpdGVtcy5sYXN0RWxlbWVudENoaWxkLCBpdGVtcy5maXJzdEVsZW1lbnRDaGlsZCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbnNsaWRlckJ1cmdlcigpO1xyXG4iXX0=
